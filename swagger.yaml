openapi: 3.0.3
info:
  title: Bookstore API
  version: 1.0.0
  description: >
    API for querying Project Gutenberg books using multiple filters,
    pagination, and sorting by popularity (download_count).

servers:
  - url: http://127.0.0.1:8000/api
    description: Local Laravel API Server

paths:
  /books:
    get:
      summary: List books with filters
      description: |
        Returns a paginated list of books matching the given filters.
        Supports multiple values (comma-separated) per filter.
        Results are sorted by download_count in descending order.
      tags:
        - Books

      parameters:
        - name: ids
          in: query
          required: false
          description: >
            Comma-separated list of Gutenberg book IDs.
            Example: ids=11,12,13
          schema:
            type: string
            example: "11,12,13"

        - name: language
          in: query
          required: false
          description: >
            Comma-separated list of language codes.
            Example: language=en,fr
          schema:
            type: string
            example: "en,fr"

        - name: mime_type
          in: query
          required: false
          description: >
            Comma-separated MIME type prefixes.
            Example: text/,application/pdf
          schema:
            type: string
            example: "text/,application/pdf"

        - name: topic
          in: query
          required: false
          description: >
            Comma-separated keywords checked (case-insensitive)
            against subjects and bookshelves.
            Example: topic=child,infant
          schema:
            type: string
            example: "child,infant"

        - name: author
          in: query
          required: false
          description: >
            Comma-separated partial author name matches.
            Example: author=austen,dickens
          schema:
            type: string
            example: "austen,dickens"

        - name: title
          in: query
          required: false
          description: >
            Comma-separated partial book title matches.
            Example: title=pride,war
          schema:
            type: string
            example: "pride,war"

        - name: page
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number (1-based index)

        - name: page_size
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 25
            default: 25
          description: Maximum allowed = 25

      responses:
        '200':
          description: Paginated list of books
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookListResponse'

              example:
                total: 1500
                page: 1
                page_size: 25
                results:
                  - id: 1342
                    title: "Pride and Prejudice"
                    genre: "Best Books Ever Listings"
                    authors:
                      - "Austen, Jane"
                    languages:
                      - "en"
                    subjects:
                      - "Courtship -- Fiction"
                      - "Young women -- Fiction"
                    bookshelves:
                      - "Best Books Ever Listings"
                    download_count: 12345
                    formats:
                      - mime_type: "text/html; charset=utf-8"
                        url: "https://www.gutenberg.org/ebooks/1342.html.images"
                      - mime_type: "application/pdf"
                        url: "https://www.gutenberg.org/ebooks/1342.pdf"

        '400':
          description: Bad Request
        '500':
          description: Internal Server Error

components:
  schemas:

    BookFormat:
      type: object
      properties:
        mime_type:
          type: string
          example: "text/html; charset=utf-8"
        url:
          type: string
          format: uri
          example: "https://www.gutenberg.org/ebooks/1342.html.images"

    Book:
      type: object
      properties:
        id:
          type: integer
          example: 1342
        title:
          type: string
          example: "Pride and Prejudice"
        genre:
          type: string
          nullable: true
          example: "Best Books Ever Listings"
        authors:
          type: array
          items:
            type: string
          example:
            - "Austen, Jane"
        languages:
          type: array
          items:
            type: string
          example:
            - "en"
        subjects:
          type: array
          items:
            type: string
          example:
            - "Courtship -- Fiction"
        bookshelves:
          type: array
          items:
            type: string
          example:
            - "Best Books Ever Listings"
        download_count:
          type: integer
          example: 12345
        formats:
          type: array
          items:
            $ref: '#/components/schemas/BookFormat'

    BookListResponse:
      type: object
      properties:
        total:
          type: integer
          example: 1500
        page:
          type: integer
          example: 1
        page_size:
          type: integer
          example: 25
        results:
          type: array
          items:
            $ref: '#/components/schemas/Book'
